/*
 * Encoder.c
 *
 *  Created on: 5 авг. 2022 г.
 *      Author: belyaev
 */
//*******************************************************************************************
//*******************************************************************************************

#include "Encoder.h"

//*******************************************************************************************
//*******************************************************************************************


//*******************************************************************************************
//*******************************************************************************************
static uint32_t _encoder_GrayToBin(uint32_t grayCode){

	grayCode ^= grayCode >> 1;
	grayCode ^= grayCode >> 2;
	grayCode ^= grayCode >> 4;
	grayCode ^= grayCode >> 8;
	grayCode ^= grayCode >> 16;
	return grayCode;
}
//*******************************************************************************************
//*******************************************************************************************
void ENCODER_Init(void){

	SPI_Init(ENCODER_SPI);
}
//**********************************************************
//Получение значение поворота энкодера.
uint32_t ENCODER_GetVal(void){

	//Чтение и выравнивание данных из энкодера.
	uint32_t encoderVal = (SPI_Rx3Byte(ENCODER_SPI) >> 6) & 0x0001FFFF; //Разрешения энкодера 17 бит.
	return _encoder_GrayToBin(encoderVal);                            			//Преобразование кода Грея в двоичный код.
}
//*******************************************************************************************
//*******************************************************************************************




